<script>loadCSS( "/css/lstyle.css", false, "all" );</script>
<?php $partial = array('layout/breadcrumbs.phtml', 'default') ?>
<?php $this->navigation('NavigationDynamic')->breadcrumbs()->setPartial($partial) ?>
<?php echo $this->navigation('NavigationDynamic')->breadcrumbs()->render() ?>
<h1><?=$title;?></h1>
<?php echo $this->partial('application/index/r_r1', array()); ?>

<?

function ins_adv($text)
{
    $text = preg_replace("/\<a(.*)\>(.*)\<\/a\>/iU", "$2", $text);
    $rand = rand(1,5);
    if($rand != 1){
        return $text;
    }

    $txt='';$i=0;
    $block = "<script async src=\"//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js\"></script>
<ins class=\"adsbygoogle\"
     style=\"display:block; text-align:center;\"
     data-ad-layout=\"in-article\"
     data-ad-format=\"fluid\"
     data-ad-client=\"ca-pub-2745956118385780\"
     data-ad-slot=\"6118227275\"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>";
    $arr = array();
    $arr1 = array();
    $tag = "</p>";
    $pieces = explode($tag, $text);
    foreach ($pieces as $piece) {
        $txt.= $piece;
        if (strlen(strip_tags($txt))>5800)
        {
            // добавляем в конец разделитель $tag,
            // т.к. в массив попадают строки без него.
            $arr[] = substr($piece, -250).$tag;
            $arr1[] = substr($piece, -250).$tag.$block;
            $txt=''; $i+=1;
        }
        if ($i==1) {break;}
    }
    return str_replace($arr, $arr1, $text);
}
?>

<div>
    <?php echo $this->partial('application/index/stars', ['id_book' => $book['id'], 'aver_value' => $book['stars'], 'count_stars' => $book['count_stars']]);?>
</div>
<div>
    <?foreach($text as $v):?>
        <?=ins_adv($v->text)?>
    <?endforeach;?>
</div>
<div class = "text-center">
    <?
    $t = $this->getHelperPluginManager()->getServiceLocator()->get('Application')->getMvcEvent()->getRouteMatch();
    $params = $t->getParams();
    if(!isset($route)){
        $route = $t->getMatchedRouteName();
    }
    if(!isset($params['s'])){
        $params['s'] = "";
    }
    echo $this->paginationControl($text, 'Sliding', 'pagination_book',
        array(
            'route' => $route,
            'action'=>$params['action'],
            's' => $params['s'],
            'alias_menu' => $params['alias_menu'],
            'book' => $params['book'],
        )); ?>
</div>


<?php echo $this->partial('application/index/r_r', array()); ?>
